---
id: m-1962
status: closed
deps: []
links: []
created: 2026-02-01T21:39:09Z
type: task
priority: 2
assignee: Steve Macbeth
parent: m-e4de
---
# Create Caddy configuration

Set up Caddy as a reverse proxy with automatic HTTPS via Let's Encrypt DNS-01 challenge through Cloudflare.

## Design

Files: scripts/setup-caddy.sh (new), caddy/Caddyfile.template (new)

Directory structure:
~/.local/services/caddy/
  Caddyfile          # generated from template with actual domain
  data/              # Caddy's cert storage (XDG_DATA_HOME equivalent)
  config/            # Caddy's config state

Caddyfile content:
{
  storage file_system {
    root ~/.local/services/caddy/data
  }
}

manager.<domain> {
  reverse_proxy localhost:3100
  tls {
    dns cloudflare {env.CLOUDFLARE_API_TOKEN}
  }
  log {
    output file ~/Library/Logs/Manager/caddy-access.log
  }
}

Setup steps (scripts/setup-caddy.sh):
1. Install caddy with cloudflare plugin via xcaddy:
   xcaddy build --with github.com/caddy-dns/cloudflare
   (or brew install caddy if cloudflare plugin available)
2. Create ~/.local/services/caddy/ directory structure
3. Prompt for domain name and Cloudflare API token
4. Generate Caddyfile from template
5. Store CF token in ~/.local/services/caddy/.env (chmod 600)
6. Test config: caddy validate --config Caddyfile

Cloudflare API token requirements:
- Zone:DNS:Edit permission for the target zone
- Create via Cloudflare dashboard -> API Tokens

## Acceptance Criteria

- Caddyfile generated with correct domain and reverse proxy config
- Caddy validates config successfully
- Cloudflare API token stored securely (600 permissions)
- HTTPS cert provisioned via DNS-01 challenge
- Reverse proxy forwards to localhost:3100

