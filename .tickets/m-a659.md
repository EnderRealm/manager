---
id: m-a659
status: open
deps: []
links: []
created: 2026-02-15T02:32:48Z
type: bug
priority: 3
assignee: Steve Macbeth
---
# Add reference counting to FSWatcher cleanup

The file watcher in watcher.ts is never cleaned up when SSE clients disconnect. events.ts calls watchProject() on connect but never calls unwatchProject() on disconnect â€” the stream.onAbort callback only unsubscribes the change handlers, not the underlying FSWatcher. This means fs.watch() file descriptors stay open for the lifetime of the server even when no clients are watching that project. Fix: add reference counting so the FSWatcher is closed when the last client for a given project disconnects.

