---
id: m-8a22
status: closed
deps: [m-94da]
links: []
created: 2026-02-01T20:16:35Z
type: task
priority: 2
assignee: Steve Macbeth
parent: m-e4de
---
# Create deployer script

Create a deployer script that polls origin/main and auto-deploys changes to the production instance.

## Design

Files: scripts/deployer.sh (new)

Behavior (runs as a launchd KeepAlive process, exits after each check, launchd restarts after ThrottleInterval):

1. cd to ~/.local/services/manager
2. git fetch origin main --quiet
3. Compare LOCAL=$(git rev-parse HEAD) vs REMOTE=$(git rev-parse origin/main)
4. If LOCAL == REMOTE: log 'No changes' and exit 0
5. If different:
   a. Log 'Deploying <short-sha>..<short-sha>'
   b. git reset --hard origin/main
   c. Check if bun.lock changed: git diff --name-only LOCAL..HEAD | grep bun.lock
      - If yes: bun install --frozen-lockfile
   d. bunx vite build
   e. Restart server: launchctl kickstart -k gui/$(id -u)/com.manager.server
   f. Log 'Deploy complete'
6. Exit 0 (launchd restarts after ThrottleInterval for next poll)

Logging:
- All output goes to stdout/stderr (launchd redirects to ~/Library/Logs/Manager/deployer.log)
- Timestamp each log line
- Log git shas, build output, restart confirmation

## Acceptance Criteria

- Script detects new commits on origin/main and deploys them
- bun install only runs when bun.lock changes
- Server restarts after successful build
- All activity logged with timestamps
- Clean exit codes (0 for success, non-zero for failures)

